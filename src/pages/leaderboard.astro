---
export const prerender = false;

// - Session
import { getSession } from "auth-astro/server";
// Components
import MostSeenCastsTable from "../components/blocks/data/MostSeenCastsTable.tsx";
// - UI
import JustHero from "../components/blocks/hero/JustHero.astro";
import AuthBlock from "../components/blocks/modal/AuthBlock.astro";
// - Layout
import Layout from "../layouts/Layout.astro";
// - SEO
const SEO = {
	title: "SassyHash ðŸ’… |Leaderboard",
	description: "See the leaderboard for SassyHash.",
};
// - Page Header
const header = {
	title: "Leaderboard",
	text: "Weekly contest to elevate the sassiest hashes.",
};

const session = await getSession(Astro.request);
const fid = session?.user?.email ? Number.parseInt(session?.user?.email) : null;
---

<Layout title={SEO.title} description={SEO.description}>
	<JustHero
		title={header.title}
		text={header.text}
		id="contact"
		classes="bg-neutral-50 dark:bg-neutral-950/80"
	>
	<AuthBlock />	
	<details class="group w-full">
		<summary class="flex w-full cursor-pointer items-center justify-between rounded-lg p-3 hover:bg-neutral-100 dark:hover:bg-neutral-900">
			<span class="text-lg sm:text-xl font-bold">Rules</span>
			<svg class="h-6 w-6 sm:h-5 sm:w-5 transition-transform group-open:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
			</svg>
		</summary>
		<div class="prose dark:prose-invert prose-neutral mt-4 px-3 pb-4 max-w-none">
			<ul>
				<li>Contest runs over same time frame as Warpcast Rewards</li>
				<li>The <strong>10</strong> most engaging SassyHash will share a <strong>$100</strong> pool</li>
				<li>One user can win multiple times</li>
				<li>Anti-collusion will be based on "decentralized retroactive delegation"</li>
			</ul>
		</div>
	</details>
	<details class="group w-full">
		<summary class="flex w-full cursor-pointer items-center justify-between rounded-lg p-3 hover:bg-neutral-100 dark:hover:bg-neutral-900">
			<span class="text-lg sm:text-xl font-bold">Payment</span>
			<svg class="h-6 w-6 sm:h-5 sm:w-5 transition-transform group-open:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
			</svg>
		</summary>
		<div class="prose dark:prose-invert prose-neutral mt-4 px-3 pb-4 max-w-none">
			<ul>
				<li>Minimum payout is <strong>$5</strong> per FID on the Leaderboard</li>
				<li>Payment will be sent to your last verified connected Ethereum address (generally, your Warpcast Wallet)</li>
				<ul><li>60% $USDC on Base</li>
				<li>30% $DEGEN on Degen L3</li>
				<li>10% $BURRITO on Base</li></ul>
				<li>Maximum payout is <strong>$100</strong> (if you made all Top 10 casts for the week)</li>
				<li>Attempts to farm/game are welcome, and will be rewarded! We learn in public.</li>
			</ul>
		</div>
	</details><details class="group w-full">
		<summary class="flex w-full cursor-pointer items-center justify-between rounded-lg p-3 hover:bg-neutral-100 dark:hover:bg-neutral-900">
			<span class="text-lg sm:text-xl font-bold">Curation/Moderation</span>
			<svg class="h-6 w-6 sm:h-5 sm:w-5 transition-transform group-open:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
			</svg>
		</summary>
		<div class="prose dark:prose-invert prose-neutral mt-4 px-3 pb-4 max-w-none">
			<ul>
				<li>Each cast qualifies by getting a minimum number of likes by SassyMods</li>
				<li>starts at <strong>0</strong> and will increase as deemed necessary</li>
				<li>No individual moderator has outsized influence</li>
				<li>Mods are free to accept bribes and collude, but may be called out and excluded as the rewards game grows</li>
				<li>There is no veto I love you</li>
			</ul>
		</div>
	</details>
	<details class="group w-full">
		<summary class="flex w-full cursor-pointer items-center justify-between rounded-lg p-3 hover:bg-neutral-100 dark:hover:bg-neutral-900">
			<span class="text-lg sm:text-xl font-bold">Nerds</span>
			<svg class="h-6 w-6 sm:h-5 sm:w-5 transition-transform group-open:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
			</svg>
		</summary>
		<div class="prose dark:prose-invert prose-neutral mt-4 px-3 pb-4 max-w-none">
			<ul>
				<li>each cast gets a raw score by multiplying by a vector of weights: </li>
				<ol>
					<li>views x 1</li>
					<li>SassyMod likes: x 0</li>
					<li>replies by other FIDs that get liked by original caster: x 0</li>
				</ol>
				<li>raw score is transformed into a smooth score via arctan function</li>
				<ul><li>this takes from the extremes and moves them toward the middle</li>
					<li>rewards repetition more than high notes (already rewarded enough)</li>
				</ul>
				<li><strong>$5</strong> is allocated to each unique FID on the leaderboard</li>
				<li><strong>rest of pool</strong> distributed pro-rata according to the smooth score</li>
			</ul>
		</div>
	</details>
	<hr />
	<MostSeenCastsTable fid={fid} client:only="react" />
	<span class="text-emphasis text-xs">as of 
		{new Date().toLocaleDateString('en-US', {timeZone: 'America/New_York'}).split(' ')[0]}
	</span> 
	<hr />
	</JustHero>
</Layout>
